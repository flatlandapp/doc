# 6.6 Mathematical Formulas Summary

The core mathematical models for character behavior control in the TW protocol can be summarized as follows:

## 6.6.1 Character State Representation

A character's state at any time can be represented as a multi-dimensional vector:

$$S_t = (A_t, K_t, R_t, E_t)$$

Where:
- $S_t$ is the character state at time $t$
- $A_t$ is the attribute vector, containing basic character attributes (strength, intelligence, agility, etc.)
- $K_t$ is the knowledge and skills vector, representing the character's knowledge and skill levels
- $R_t$ is the relationship network, describing the character's relationship status with other entities
- $E_t$ is the emotional state, representing the character's current emotions and psychological state

## 6.6.2 Behavior Decision Function

The AI agent generates behavior decisions based on character state, player intent, and environmental information:

$$B_t = f(S_t, I_t, W_t, H_{t-k:t-1}, \theta)$$

Where:
- $B_t$ is the behavior decision at time $t$
- $S_t$ is the current character state
- $I_t$ is the player intent
- $W_t$ is the current world state
- $H_{t-k:t-1}$ is the historical behavior sequence, containing behaviors from the past $k$ time steps
- $\theta$ is the AI model parameter, determining the character's "personality" and decision preferences

## 6.6.3 State Transition Function

After executing a behavior, the character's state changes based on the behavior result and environmental feedback:

$$S_{t+1} = g(S_t, B_t, W_t, \epsilon_t)$$

Where:
- $g$ is the state transition function
- $S_t$ is the current state
- $B_t$ is the executed behavior
- $W_t$ is the current world state
- $\epsilon_t$ is the random factor, representing environmental uncertainty

## 6.6.4 Player Intent Influence Function

Player intent is expressed in various ways and integrated to influence the AI agent:

$$I_t = h(M_t, P_t, O_t)$$

Where:
- $I_t$ is the integrated intent vector
- $M_t$ is the explicitly expressed goals
- $P_t$ is the player preference settings
- $O_t$ is the long-term goals and value settings

## 6.6.5 Character Development Function

Over time and with experience accumulation, characters naturally develop and grow:

$$\Delta S_t = \phi(S_t, B_t, E_t, t)$$

Where:
- $\Delta S_t$ is the state change amount
- $S_t$ is the current state
- $B_t$ is the executed behavior
- $E_t$ is the environmental influence
- $\phi$ is the development function, describing how characters learn and grow from experiences
- $t$ is the time factor, as some developments may be directly related to time

## 6.6.6 Behavior Compliance Verification

Behaviors need to pass multi-layer verification to ensure compliance with game rules and character capabilities:

$$V(B_t, S_t, W_t) = V_r(B_t, W_t) \land V_c(B_t, S_t) \land V_h(B_t, H_{t-k:t-1})$$

Where:
- $V$ is the overall verification function
- $V_r$ verifies if the behavior complies with game world rules
- $V_c$ verifies if the behavior is within the character's capabilities
- $V_h$ verifies if the behavior maintains consistency with historical behaviors

## 6.6.7 Decision Entropy and Uncertainty

To ensure diversity and unpredictability of character behaviors, sufficient decision entropy needs to be maintained:

$$H(B_t) = -\sum_{i=1}^{n} p(b_i) \log_2 p(b_i) \geq H_{min}$$

Where:
- $H(B_t)$ is the entropy of behavior decisions
- $p(b_i)$ is the probability of specific behavior $b_i$
- $H_{min}$ is the minimum entropy threshold, ensuring behaviors are not overly deterministic

## 6.6.8 Intent-Behavior Alignment

Evaluating the alignment between AI agent behaviors and player intent:

$$A(B_t, I_t) = \cos(v_{B_t}, v_{I_t}) = \frac{v_{B_t} \cdot v_{I_t}}{||v_{B_t}|| \cdot ||v_{I_t}||}$$

Where:
- $A$ is the alignment function, with a range of [-1,1]
- $v_{B_t}$ is the vector representation of behavior $B_t$
- $v_{I_t}$ is the vector representation of intent $I_t$

These mathematical models together form the theoretical foundation of the TW protocol's character behavior control system, ensuring that the behaviors generated by AI agents align with character traits, reflect player intent to some extent, while maintaining sufficient autonomy and unpredictability, creating an authentic and engaging gaming experience.
